<!DOCTYPE html>
<html lang="es">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TBLYXSDHQX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-TBLYXSDHQX');
    </script>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO B√ÅSICO -->
    <meta name="description" content="Hermosa p√°gina interactiva de flores amarillas para el 21 de septiembre. M√∫sica relajante, frases inspiradoras y animaciones de girasoles.">
    <meta name="keywords" content="flores amarillas, girasoles, 21 septiembre, m√∫sica, frases inspiradoras">

    <!-- FAVICON -->
    <link rel="icon" href="img/flowers.png" type="image/x-icon" />
    <link rel="stylesheet" href="css/style.css">


    <title>Flores Para Ti - 21 de Septiembre</title>

</head>


<body class="container">
    <!-- AUDIO CON FALLBACKS -->
    <audio id="mainAudio" loop preload="auto" crossorigin="anonymous">
        <source src="sound/FloresAmarillas.mp3" type="audio/mpeg">
        <source src="sound/FloresAmarillas.ogg" type="audio/ogg">
        <source src="sound/FloresAmarillas.wav" type="audio/wav">
        Tu navegador no soporta audio HTML5.
    </audio>

    <!-- ESTRELLAS CAYENDO -->
    <div class="falling-stars" id="fallingStars"></div>

    <!-- ========== CONTENIDO DESKTOP ========== -->

    <!-- MENSAJE PRINCIPAL DESKTOP -->
    <div class="main-message">
        <div class="sunflower-icon">üåª</div>
        <div class="message-text">
            Flores Para Ti<br>
            <span class="date-highlight">Feliz 21 de Septiembre</span>
        </div>
        <div class="sunflower-icon">üåª</div>
    </div>

    <!-- CONTROL MUSICAL DESKTOP -->
    <div class="music-player">
        <h3>üéµ Control Musical</h3>
        <div class="current-song" id="currentSongName">‚ô™</div>
        <div class="music-controls">
            <button class="control-btn" id="prevBtn" aria-label="Canci√≥n anterior">‚èÆÔ∏è</button>
            <button class="control-btn" id="playPauseBtn" aria-label="Reproducir o pausar">‚ñ∂Ô∏è</button>
            <button class="control-btn" id="nextBtn" aria-label="Siguiente canci√≥n">‚è≠Ô∏è</button>
        </div>
    </div>

    <!-- SECCI√ìN DE FRASES DESKTOP -->
    <div class="quotes-section">
        <h3>üåª Frases üåª</h3>
        <div class="quote-display short-text" id="quoteDisplay">
            "üå∫ La amistad es el ingrediente m√°s importante en la receta de la vida."
        </div>
        <div class="quote-controls">
            <button class="quote-btn" onclick="changeQuote()">Nueva Frase</button>
        </div>
    </div>

    <!-- FLORES DESKTOP - DISE√ëO ORIGINAL -->
    <div class="flowers-container">
        <div class="flowers" id="flowersContainer">
            <!-- Girasol 1 -->
            <div class="flower flower--1" data-flower-id="1" tabindex="0">
                <div class="flower__leafs flower__leafs--1">
                    <div class="flower__leaf flower__leaf--1"></div>
                    <div class="flower__leaf flower__leaf--2"></div>
                    <div class="flower__leaf flower__leaf--3"></div>
                    <div class="flower__leaf flower__leaf--4"></div>
                    <div class="flower__white-circle"></div>
                    <div class="flower__light flower__light--1"></div>
                    <div class="flower__light flower__light--2"></div>
                    <div class="flower__light flower__light--3"></div>
                    <div class="flower__light flower__light--4"></div>
                    <div class="flower__light flower__light--5"></div>
                    <div class="flower__light flower__light--6"></div>
                    <div class="flower__light flower__light--7"></div>
                    <div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                    <div class="flower__line__leaf flower__line__leaf--1"></div>
                    <div class="flower__line__leaf flower__line__leaf--2"></div>
                    <div class="flower__line__leaf flower__line__leaf--3"></div>
                    <div class="flower__line__leaf flower__line__leaf--4"></div>
                    <div class="flower__line__leaf flower__line__leaf--5"></div>
                    <div class="flower__line__leaf flower__line__leaf--6"></div>
                </div>
            </div>

            <!-- Girasol 2 -->
            <div class="flower flower--2" data-flower-id="2" tabindex="0">
                <div class="flower__leafs flower__leafs--2">
                    <div class="flower__leaf flower__leaf--1"></div>
                    <div class="flower__leaf flower__leaf--2"></div>
                    <div class="flower__leaf flower__leaf--3"></div>
                    <div class="flower__leaf flower__leaf--4"></div>
                    <div class="flower__white-circle"></div>
                    <div class="flower__light flower__light--1"></div>
                    <div class="flower__light flower__light--2"></div>
                    <div class="flower__light flower__light--3"></div>
                    <div class="flower__light flower__light--4"></div>
                    <div class="flower__light flower__light--5"></div>
                    <div class="flower__light flower__light--6"></div>
                    <div class="flower__light flower__light--7"></div>
                    <div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                    <div class="flower__line__leaf flower__line__leaf--1"></div>
                    <div class="flower__line__leaf flower__line__leaf--2"></div>
                    <div class="flower__line__leaf flower__line__leaf--3"></div>
                    <div class="flower__line__leaf flower__line__leaf--4"></div>
                </div>
            </div>

            <!-- Girasol 3 -->
            <div class="flower flower--3" data-flower-id="3" tabindex="0">
                <div class="flower__leafs flower__leafs--3">
                    <div class="flower__leaf flower__leaf--1"></div>
                    <div class="flower__leaf flower__leaf--2"></div>
                    <div class="flower__leaf flower__leaf--3"></div>
                    <div class="flower__leaf flower__leaf--4"></div>
                    <div class="flower__white-circle"></div>
                    <div class="flower__light flower__light--1"></div>
                    <div class="flower__light flower__light--2"></div>
                    <div class="flower__light flower__light--3"></div>
                    <div class="flower__light flower__light--4"></div>
                    <div class="flower__light flower__light--5"></div>
                    <div class="flower__light flower__light--6"></div>
                    <div class="flower__light flower__light--7"></div>
                    <div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                    <div class="flower__line__leaf flower__line__leaf--1"></div>
                    <div class="flower__line__leaf flower__line__leaf--2"></div>
                    <div class="flower__line__leaf flower__line__leaf--3"></div>
                    <div class="flower__line__leaf flower__line__leaf--4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== CONTENIDO M√ìVIL ========== -->
    <div class="mobile-container">

        <!-- MENSAJE PRINCIPAL M√ìVIL -->
        <div class="main-message">
            <div class="sunflower-icon">üåª</div>
            <div class="message-text">
                Flores Para Ti<br>
                <span class="date-highlight">Feliz 21 de Septiembre</span>
            </div>
            <div class="sunflower-icon">üåª</div>
        </div>

        <!-- FRASES M√ìVIL -->
        <div class="quotes-section mobile-quotes">
            <h3>üåª Frases üåª</h3>
            <div class="quote-display short-text" id="mobileQuoteDisplay">
                "üå∫ La amistad es el ingrediente m√°s importante en la receta de la vida."
            </div>
            <div class="quote-controls">
                <button class="quote-btn" onclick="changeQuote()">Nueva Frase</button>
            </div>
        </div>

        <!-- FLORES M√ìVIL - DISE√ëO ORIGINAL -->
        <div class="flowers-container">
            <div class="flowers" id="mobileFlowersContainer">
                <!-- Girasoles m√≥viles id√©nticos a desktop -->
                <div class="flower flower--1" data-flower-id="m1" tabindex="0">
                    <div class="flower__leafs flower__leafs--1">
                        <div class="flower__leaf flower__leaf--1"></div>
                        <div class="flower__leaf flower__leaf--2"></div>
                        <div class="flower__leaf flower__leaf--3"></div>
                        <div class="flower__leaf flower__leaf--4"></div>
                        <div class="flower__white-circle"></div>
                        <div class="flower__light flower__light--1"></div>
                        <div class="flower__light flower__light--2"></div>
                        <div class="flower__light flower__light--3"></div>
                        <div class="flower__light flower__light--4"></div>
                        <div class="flower__light flower__light--5"></div>
                        <div class="flower__light flower__light--6"></div>
                        <div class="flower__light flower__light--7"></div>
                        <div class="flower__light flower__light--8"></div>
                    </div>
                    <div class="flower__line">
                        <div class="flower__line__leaf flower__line__leaf--1"></div>
                        <div class="flower__line__leaf flower__line__leaf--2"></div>
                        <div class="flower__line__leaf flower__line__leaf--3"></div>
                        <div class="flower__line__leaf flower__line__leaf--4"></div>
                        <div class="flower__line__leaf flower__line__leaf--5"></div>
                        <div class="flower__line__leaf flower__line__leaf--6"></div>
                    </div>
                </div>

                <div class="flower flower--2" data-flower-id="m2" tabindex="0">
                    <div class="flower__leafs flower__leafs--2">
                        <div class="flower__leaf flower__leaf--1"></div>
                        <div class="flower__leaf flower__leaf--2"></div>
                        <div class="flower__leaf flower__leaf--3"></div>
                        <div class="flower__leaf flower__leaf--4"></div>
                        <div class="flower__white-circle"></div>
                        <div class="flower__light flower__light--1"></div>
                        <div class="flower__light flower__light--2"></div>
                        <div class="flower__light flower__light--3"></div>
                        <div class="flower__light flower__light--4"></div>
                        <div class="flower__light flower__light--5"></div>
                        <div class="flower__light flower__light--6"></div>
                        <div class="flower__light flower__light--7"></div>
                        <div class="flower__light flower__light--8"></div>
                    </div>
                    <div class="flower__line">
                        <div class="flower__line__leaf flower__line__leaf--1"></div>
                        <div class="flower__line__leaf flower__line__leaf--2"></div>
                        <div class="flower__line__leaf flower__line__leaf--3"></div>
                        <div class="flower__line__leaf flower__line__leaf--4"></div>
                    </div>
                </div>

                <div class="flower flower--3" data-flower-id="m3" tabindex="0">
                    <div class="flower__leafs flower__leafs--3">
                        <div class="flower__leaf flower__leaf--1"></div>
                        <div class="flower__leaf flower__leaf--2"></div>
                        <div class="flower__leaf flower__leaf--3"></div>
                        <div class="flower__leaf flower__leaf--4"></div>
                        <div class="flower__white-circle"></div>
                        <div class="flower__light flower__light--1"></div>
                        <div class="flower__light flower__light--2"></div>
                        <div class="flower__light flower__light--3"></div>
                        <div class="flower__light flower__light--4"></div>
                        <div class="flower__light flower__light--5"></div>
                        <div class="flower__light flower__light--6"></div>
                        <div class="flower__light flower__light--7"></div>
                        <div class="flower__light flower__light--8"></div>
                    </div>
                    <div class="flower__line">
                        <div class="flower__line__leaf flower__line__leaf--1"></div>
                        <div class="flower__line__leaf flower__line__leaf--2"></div>
                        <div class="flower__line__leaf flower__line__leaf--3"></div>
                        <div class="flower__line__leaf flower__line__leaf--4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√öSICA M√ìVIL -->
        <div class="mobile-music-player">
            <h3>üéµ Control Musical</h3>
            <div class="current-song" id="mobileCurrentSongName">‚ô™</div>
            <div class="music-controls">
                <button class="control-btn" id="mobilePrevBtn" aria-label="Anterior">‚èÆÔ∏è</button>
                <button class="control-btn" id="mobilePlayPauseBtn" aria-label="Play/Pause">‚ñ∂Ô∏è</button>
                <button class="control-btn" id="mobileNextBtn" aria-label="Siguiente">‚è≠Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- LETRAS Y T√çTULO -->
    <div id="lyrics"></div>
    <h1 class="titulo"></h1>

</body>

<script>
// Variables globales
let audio = document.getElementById('mainAudio');
let lyrics = document.querySelector("#lyrics");
let flowerCounter = 3;
let nextFlowerId = 4;
let currentSongIndex = 0;
let isPlaying = false;
let autoQuoteEnabled = false;
let quoteInterval;
let autoFlowerInterval;
let audioInitialized = false;

// CONFIGURACI√ìN DE AUTO-FLORES
const MAX_FLOWERS = 15; // L√≠mite m√°ximo de flores
const AUTO_FLOWER_INTERVAL = 8000; // 8 segundos entre cada nueva flor
let autoFlowerEnabled = false; // Control del auto-incremento

// Lista de canciones con nombres amigables
const playlist = [
    {
        file: "sound/FloresAmarillas.mp3",
        name: "‚ô™ Flores Amarillas - Floricienta"
    },
    {
        file: "sound/ColorEsperanza.mp3", 
        name: "‚ô™ Color Esperanza - Diego Torres"
    },
    {
        file: "sound/Sunflower.mp3",
        name: "‚ô™ Sunflower - Post Malone & Swae Lee"
    },
    {
        file: "sound/Yellow.mp3",
        name: "‚ô™ Yellow - Coldplay"
    }
];

// Frases rom√°nticas
const romanticQuotes = [
    "üåº La vida es mejor con amigos que se vuelven familia",
    "üíõ La amistad verdadera no se trata de ser inseparables, sino de poder estar separados y que nada cambie",
    "‚ú® Un verdadero amigo es aquel que conoce tus cicatrices y a√∫n as√≠ elige quedarse",
    "üåª La amistad es el √∫nico cemento que podr√° mantener unido al mundo",
    "üíù Los amigos son la familia que elegimos",
    "üåû Un amigo fiel es un refugio seguro; el que lo encuentra ha encontrado un tesoro",
    "üéà Los amigos verdaderos son como las estrellas, no siempre las ves, pero sabes que est√°n ah√≠",
    "üå∏ La amistad duplica las alegr√≠as y divide las angustias por la mitad",
    "üí´ Los mejores momentos de la vida se disfrutan mejor cuando se comparten con un amigo",
    "üå∫ Un verdadero amigo es alguien que te conoce tal como eres, comprende d√≥nde has estado, te acompa√±a en tus logros y fallas, y a√∫n as√≠ te permite crecer"
];

// AUTOPLAY AUTOM√ÅTICO MEJORADO - M√öLTIPLES ESTRATEGIAS
function initializeAudio() {
    if (!audio || audioInitialized) return;

    console.log('üéµ Inicializando audio...');

    // Estrategia 1: Intentar reproducir inmediatamente
    tryAutoplay()
        .then(() => {
            console.log('‚úÖ Autoplay exitoso - Estrategia 1');
            audioInitialized = true;
        })
        .catch(() => {
            console.log('‚ö†Ô∏è Estrategia 1 fall√≥, intentando Estrategia 2...');
            // Estrategia 2: Esperar primer clic/toque
            setupUserInteractionAutoplay();
        });
}

// Estrategia 1: Autoplay directo
function tryAutoplay() {
    return new Promise((resolve, reject) => {
        if (!audio) {
            reject('No audio element');
            return;
        }

        // Configurar audio
        audio.volume = 0.7;
        audio.muted = false; // Desmutear para autoplay real

        // Intentar reproducir
        const playPromise = audio.play();

        if (playPromise !== undefined) {
            playPromise
                .then(() => {
                    isPlaying = true;
                    updateCurrentSongName();
                    updatePlayPauseButtons();
                    console.log('üé∂ M√∫sica iniciada autom√°ticamente');
                    resolve();
                })
                .catch(error => {
                    console.log('Autoplay bloqueado por el navegador:', error.message);
                    reject(error);
                });
        } else {
            reject('Play promise undefined');
        }
    });
}

// Estrategia 2: Autoplay al primer click/toque del usuario
function setupUserInteractionAutoplay() {
    const startAudioOnInteraction = () => {
        if (!audioInitialized && audio) {
            console.log('üëÜ Usuario interactu√≥, iniciando m√∫sica...');

            audio.muted = false;
            const playPromise = audio.play();

            if (playPromise) {
                playPromise
                    .then(() => {
                        isPlaying = true;
                        updateCurrentSongName();
                        updatePlayPauseButtons();
                        audioInitialized = true;
                        console.log('üé∂ M√∫sica iniciada por interacci√≥n');

                        // Remover listeners despu√©s del primer uso
                        document.removeEventListener('click', startAudioOnInteraction);
                        document.removeEventListener('touchstart', startAudioOnInteraction);
                        document.removeEventListener('keydown', startAudioOnInteraction);
                    })
                    .catch(error => {
                        console.log('Error al iniciar audio:', error);
                    });
            }
        }
    };

    // Escuchar cualquier interacci√≥n del usuario
    document.addEventListener('click', startAudioOnInteraction, { once: false });
    document.addEventListener('touchstart', startAudioOnInteraction, { once: false });
    document.addEventListener('keydown', startAudioOnInteraction, { once: false });

    console.log('üéØ Esperando interacci√≥n del usuario para iniciar m√∫sica...');
}

// ========== FUNCIONES DE AUTO-FLORES ========== 
// Crear una nueva flor din√°micamente
function createNewFlower(containerId) {
    if (flowerCounter >= MAX_FLOWERS) {
        console.log(`üö´ L√≠mite m√°ximo de ${MAX_FLOWERS} flores alcanzado`);
        return null;
    }

    const container = document.getElementById(containerId);
    if (!container) return null;

    const flower = document.createElement('div');
    flower.className = `flower flower--dynamic new-flower dancing`;
    flower.setAttribute('data-flower-id', nextFlowerId);
    flower.setAttribute('tabindex', '0');

    // Posici√≥n aleatoria para que no se superpongan
    const leftPosition = 15 + Math.random() * 70; // Entre 15% y 85%
    flower.style.left = `${leftPosition}%`;

    // A√±adir transformaci√≥n aleatoria para variedad
    const rotation = (Math.random() - 0.5) * 40; // Entre -20deg y 20deg
    flower.style.transform = `rotate(${rotation}deg)`;

    // Estructura completa de la flor (id√©ntica al dise√±o original)
    flower.innerHTML = `
        <div class="flower__leafs flower__leafs--${(nextFlowerId % 3) + 1}">
            <div class="flower__leaf flower__leaf--1"></div>
            <div class="flower__leaf flower__leaf--2"></div>
            <div class="flower__leaf flower__leaf--3"></div>
            <div class="flower__leaf flower__leaf--4"></div>
            <div class="flower__white-circle"></div>
            <div class="flower__light flower__light--1"></div>
            <div class="flower__light flower__light--2"></div>
            <div class="flower__light flower__light--3"></div>
            <div class="flower__light flower__light--4"></div>
            <div class="flower__light flower__light--5"></div>
            <div class="flower__light flower__light--6"></div>
            <div class="flower__light flower__light--7"></div>
            <div class="flower__light flower__light--8"></div>
        </div>
        <div class="flower__line">
            <div class="flower__line__leaf flower__line__leaf--1"></div>
            <div class="flower__line__leaf flower__line__leaf--2"></div>
            <div class="flower__line__leaf flower__line__leaf--3"></div>
            <div class="flower__line__leaf flower__line__leaf--4"></div>
            <div class="flower__line__leaf flower__line__leaf--5"></div>
            <div class="flower__line__leaf flower__line__leaf--6"></div>
        </div>
    `;

    // Event listeners para interacci√≥n
    flower.addEventListener('click', () => createSparkles(flower));
    flower.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            createSparkles(flower);
        }
    });

    // Agregar al contenedor
    container.appendChild(flower);

    // Incrementar contadores
    flowerCounter++;
    nextFlowerId++;

    console.log(`üåª Nueva flor creada! Total: ${flowerCounter}/${MAX_FLOWERS}`);

    return flower;
}

// Iniciar auto-incremento de flores
function startAutoFlowers() {
    if (autoFlowerEnabled || flowerCounter >= MAX_FLOWERS) return;

    autoFlowerEnabled = true;
    console.log(`üå± Iniciando auto-incremento de flores cada ${AUTO_FLOWER_INTERVAL/1000} segundos...`);

    autoFlowerInterval = setInterval(() => {
        if (flowerCounter >= MAX_FLOWERS) {
            stopAutoFlowers();
            console.log(`üå∏ Jard√≠n completo! ${MAX_FLOWERS} flores plantadas`);
            return;
        }

        // Crear flor en desktop
        createNewFlower('flowersContainer');

        // Crear flor en m√≥vil (si existe)
        const mobileContainer = document.getElementById('mobileFlowersContainer');
        if (mobileContainer) {
            createNewFlower('mobileFlowersContainer');
        }

    }, AUTO_FLOWER_INTERVAL);
}

// Detener auto-incremento de flores
function stopAutoFlowers() {
    if (autoFlowerInterval) {
        clearInterval(autoFlowerInterval);
        autoFlowerInterval = null;
        autoFlowerEnabled = false;
        console.log('‚èπÔ∏è Auto-incremento de flores detenido');
    }
}

// Toggle auto-incremento de flores (funci√≥n p√∫blica)
function toggleAutoFlowers() {
    if (autoFlowerEnabled) {
        stopAutoFlowers();
    } else {
        startAutoFlowers();
    }
}

// Agregar una flor manualmente (funci√≥n p√∫blica)
function addFlower() {
    if (flowerCounter >= MAX_FLOWERS) {
        console.log(`üö´ No se pueden agregar m√°s flores. L√≠mite: ${MAX_FLOWERS}`);
        return;
    }

    // Agregar en desktop
    createNewFlower('flowersContainer');

    // Agregar en m√≥vil
    createNewFlower('mobileFlowersContainer');
}

// Actualizar el nombre de la canci√≥n actual
function updateCurrentSongName() {
    const songNameElement = document.getElementById('currentSongName');
    const mobileSongNameElement = document.getElementById('mobileCurrentSongName');
    const currentSong = playlist[currentSongIndex];

    if (songNameElement && currentSong) {
        songNameElement.textContent = currentSong.name;
        songNameElement.classList.toggle('playing', isPlaying);
    }

    if (mobileSongNameElement && currentSong) {
        mobileSongNameElement.textContent = currentSong.name;
        mobileSongNameElement.classList.toggle('playing', isPlaying);
    }
}

// Actualizar botones de play/pause
function updatePlayPauseButtons() {
    const playBtn = document.getElementById('playPauseBtn');
    const mobilePlayBtn = document.getElementById('mobilePlayPauseBtn');

    const symbol = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';

    if (playBtn) playBtn.textContent = symbol;
    if (mobilePlayBtn) mobilePlayBtn.textContent = symbol;
}

// Toggle play/pause
function togglePlayPause() {
    if (!audio) return;

    if (isPlaying) {
        audio.pause();
        isPlaying = false;
        console.log('‚è∏Ô∏è M√∫sica pausada');
    } else {
        const playPromise = audio.play();
        if (playPromise !== undefined) {
            playPromise.then(() => {
                isPlaying = true;
                console.log('‚ñ∂Ô∏è M√∫sica reanudada');
            }).catch(error => {
                console.log("Error al reproducir:", error);
                isPlaying = false;
            });
        }
    }

    updatePlayPauseButtons();
    updateCurrentSongName();
}

// Cambiar canci√≥n
function changeSong() {
    const currentSong = playlist[currentSongIndex];
    if (currentSong && audio) {
        console.log(`üîÑ Cambiando a: ${currentSong.name}`);
        audio.src = currentSong.file;

        if (isPlaying) {
            // Peque√±a pausa para cargar la nueva canci√≥n
            setTimeout(() => {
                audio.play().catch(error => {
                    console.log("Error al cambiar canci√≥n:", error);
                });
            }, 100);
        }
        updateCurrentSongName();
    }
}

// Siguiente canci√≥n
function playNextSong() {
    currentSongIndex = (currentSongIndex + 1) % playlist.length;
    changeSong();
}

// Canci√≥n anterior
function playPrevSong() {
    currentSongIndex = currentSongIndex === 0 ? playlist.length - 1 : currentSongIndex - 1;
    changeSong();
}

// Cambiar frase
function changeQuote() {
    const randomIndex = Math.floor(Math.random() * romanticQuotes.length);
    const newQuote = romanticQuotes[randomIndex];

    const quoteElement = document.getElementById('quoteDisplay');
    const mobileQuoteElement = document.getElementById('mobileQuoteDisplay');

    // Actualizar frase desktop
    if (quoteElement) {
        quoteElement.textContent = newQuote;

        // Clasificar por longitud
        quoteElement.className = quoteElement.className.replace(/\b(short|medium|long)-text\b/g, '');
        if (newQuote.length < 60) {
            quoteElement.classList.add('short-text');
        } else if (newQuote.length < 120) {
            quoteElement.classList.add('medium-text');
        } else {
            quoteElement.classList.add('long-text');
        }
    }

    // Actualizar frase m√≥vil
    if (mobileQuoteElement) {
        mobileQuoteElement.textContent = newQuote;

        // Clasificar por longitud
        mobileQuoteElement.className = mobileQuoteElement.className.replace(/\b(short|medium|long)-text\b/g, '');
        if (newQuote.length < 60) {
            mobileQuoteElement.classList.add('short-text');
        } else if (newQuote.length < 120) {
            mobileQuoteElement.classList.add('medium-text');
        } else {
            mobileQuoteElement.classList.add('long-text');
        }
    }
}

// Toggle frases autom√°ticas
function toggleAutoQuote() {
    autoQuoteEnabled = !autoQuoteEnabled;
    const autoBtn = document.getElementById('autoBtn');
    const mobileAutoBtn = document.getElementById('mobileAutoBtn');

    const newText = `Auto: ${autoQuoteEnabled ? 'ON' : 'OFF'}`;

    if (autoBtn) autoBtn.textContent = newText;
    if (mobileAutoBtn) mobileAutoBtn.textContent = newText;

    if (autoQuoteEnabled) {
        quoteInterval = setInterval(changeQuote, 5000); // Cambiar cada 5 segundos
        console.log('üîÑ Frases autom√°ticas activadas');
    } else {
        if (quoteInterval) {
            clearInterval(quoteInterval);
            quoteInterval = null;
        }
        console.log('‚èπÔ∏è Frases autom√°ticas desactivadas');
    }
}

// Crear efecto sparkle
function createSparkles(flower) {
    const rect = flower.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    // Crear m√∫ltiples sparkles
    for (let i = 0; i < 5; i++) {
        setTimeout(() => {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.textContent = ['‚ú®', 'üåü', '‚≠ê', 'üí´'][Math.floor(Math.random() * 4)];

            // Posici√≥n aleatoria alrededor de la flor
            sparkle.style.left = `${centerX + (Math.random() - 0.5) * 100}px`;
            sparkle.style.top = `${centerY + (Math.random() - 0.5) * 100}px`;

            document.body.appendChild(sparkle);

            // Eliminar despu√©s de la animaci√≥n
            setTimeout(() => {
                sparkle.remove();
            }, 2000);
        }, i * 200);
    }
}

// Crear estrella cayendo
function createFallingStar() {
    const star = document.createElement('div');
    star.className = `falling-star ${Math.random() > 0.5 ? 'white' : 'yellow'}`;
    star.textContent = ['‚≠ê', '‚ú®', 'üåü'][Math.floor(Math.random() * 3)];

    // Posici√≥n aleatoria en la parte superior
    star.style.left = `${Math.random() * 100}%`;
    star.style.animationDuration = `${3 + Math.random() * 4}s`;

    const container = document.getElementById('fallingStars');
    if (container) {
        container.appendChild(star);

        // Eliminar despu√©s de la animaci√≥n
        setTimeout(() => {
            star.remove();
        }, 7000);
    }
}

// Configurar interacciones de flores existentes y nuevas
function setupFlowerInteractions() {
    const flowers = document.querySelectorAll('.flower');
    flowers.forEach(flower => {
        // Verificar si ya tiene event listeners para evitar duplicados
        if (!flower.hasAttribute('data-listeners-added')) {
            flower.addEventListener('click', () => {
                createSparkles(flower);
            });

            flower.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    createSparkles(flower);
                }
            });

            // Marcar como procesada
            flower.setAttribute('data-listeners-added', 'true');
        }
    });
}

// INICIALIZACI√ìN PRINCIPAL
document.addEventListener('DOMContentLoaded', function() {
    console.log('üåª Flores Para Ti - Inicializando...');

    // Inicializar audio inmediatamente
    audio = document.getElementById('mainAudio');

    // INICIAR AUTOPLAY AUTOM√ÅTICO INMEDIATAMENTE
    setTimeout(() => {
        initializeAudio();
    }, 500); // Peque√±a pausa para asegurar que todo est√© cargado

    // INICIAR AUTO-INCREMENTO DE FLORES despu√©s de 10 segundos
    setTimeout(() => {
        startAutoFlowers();
        console.log('üå± Sistema de auto-flores activado');
    }, 10000); // Esperar 10 segundos despu√©s de cargar

    // Configurar controles de m√∫sica desktop
    const playBtn = document.getElementById('playPauseBtn');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');

    if (playBtn) playBtn.addEventListener('click', togglePlayPause);
    if (nextBtn) nextBtn.addEventListener('click', playNextSong);
    if (prevBtn) prevBtn.addEventListener('click', playPrevSong);

    // Configurar controles de m√∫sica m√≥vil
    const mobilePlayBtn = document.getElementById('mobilePlayPauseBtn');
    const mobileNextBtn = document.getElementById('mobileNextBtn');
    const mobilePrevBtn = document.getElementById('mobilePrevBtn');

    if (mobilePlayBtn) mobilePlayBtn.addEventListener('click', togglePlayPause);
    if (mobileNextBtn) mobileNextBtn.addEventListener('click', playNextSong);
    if (mobilePrevBtn) mobilePrevBtn.addEventListener('click', playPrevSong);

    // Configurar eventos de audio
    if (audio) {
        audio.addEventListener('ended', playNextSong);
        audio.addEventListener('canplay', () => {
            updateCurrentSongName();
        });

        // Evento cuando la m√∫sica se carga y est√° lista
        audio.addEventListener('loadeddata', () => {
            console.log('üéµ Audio cargado y listo');
            updateCurrentSongName();
        });
    }

    // Configurar interacciones de flores
    setupFlowerInteractions();

    // Reconfigurar interacciones cada 2 segundos para flores nuevas
    setInterval(() => {
        setupFlowerInteractions();
    }, 2000);

    // Crear estrellas cayendo peri√≥dicamente
    setInterval(createFallingStar, 2000);

    console.log('‚úÖ Flores Para Ti - Inicializado completamente');
    console.log(`üåª Configuraci√≥n: M√°ximo ${MAX_FLOWERS} flores, intervalo ${AUTO_FLOWER_INTERVAL/1000}s`);
});

// Service Worker registration (si existe)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => {
                console.log('SW registered: ', registration);
            })
            .catch(registrationError => {
                console.log('SW registration failed: ', registrationError);
            });
    });
}

// ========== FUNCIONES P√öBLICAS DISPONIBLES ==========
// Estas funciones pueden ser llamadas desde la consola o eventos HTML:
// - addFlower() - Agregar una flor manualmente
// - toggleAutoFlowers() - Activar/desactivar auto-incremento
// - stopAutoFlowers() - Detener auto-incremento
// - startAutoFlowers() - Iniciar auto-incremento
// - changeQuote() - Cambiar frase manualmente
// - toggleAutoQuote() - Activar/desactivar frases autom√°ticas
</script>

</html>